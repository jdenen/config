* Emacs <> Elixir

macOS machine configuration

** antigen
Install =antigen= for oh-my-zsh bundle management:

#+BEGIN_SRC sh :export none :eval query
curl -L git.io/antigen > ~/antigen.zsh
#+END_SRC
** oh-my-zsh
Write this to =~/.zshrc=:

#+BEGIN_SRC sh :tangle ~/.zshrc :eval no
source ~/antigen.zsh
antigen use oh-my-zsh

antigen bundle asdf
antigen bundle docker
antigen bundle emacs
antigen bundle git
antigen bundle osx
antigen bundle zsh-users/zsh-syntax-highlighting
antigen bundle zsh-users/zsh-history-substring-search
antigen bundle zsh-users/zsh-completions

antigen theme bureau

antigen apply

eval "$(direnv hook zsh)"

alias ls='ls -aFG'
#+END_SRC
** brew
Install Homebrew:

#+BEGIN_SRC sh :export none :eval query
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
#+END_SRC

Install command line tools:

#+BEGIN_SRC sh :export none :eval query
brew install git ripgrep fd gnutls sd gpg ctop pre-commit pinentry-mac cmake libvterm
#+END_SRC

Install Docker:

#+BEGIN_SRC sh :export none :eval query
brew cask install docker
#+END_SRC
** user
Replace my name and email with your own:

#+BEGIN_SRC sh :export none :eval query
rg "Johnson Denen" --files-with-matches | xargs sd -s "Johnson Denen" "Your name"
rg "johnson.denen@gmail.com" --files-with-matches | xargs sd -s "johnson.denen@gmail.com" "Your email"
#+END_SRC
** git
Install Homebrew's Git:

#+BEGIN_SRC sh :export none :eval query
brew install git
#+END_SRC

Set Git defaults via =~/.gitconfig=:

#+BEGIN_SRC conf :tangle ~/.gitconfig
[user]
name = Johnson Denen
email = johnson.denen@gmail.com

[alias]
log = log --graph

[color]
ui = true

[diff]
renames = true

[fetch]
prune = true

[pull]
rebase = true

[commit]
gpgsign = true

[push]
default = simple
ff = false

[rerere]
enabled = true

[core]
excludesfile = ~/.gitignore
#+END_SRC

Ignore some files by default via =~/.gitignore=:

#+BEGIN_SRC conf :tangle ~/.gitignore
.DS_Store
.elixir_ls/
todo.org
#+END_SRC
*** gpg
Create a GPG key per your requirements and grab your key's fingerprint:

#+BEGIN_SRC sh :export none :eval no
gpg --list-secret-keys --keyid-format LONG
#+END_SRC

Add it to Git's user configuration:

#+BEGIN_SRC sh :export none :eval no
git config --global user.signingkey $YOUR_KEY_FINGERPRINT
#+END_SRC

Use GUI =pinentry= for ease of use with Magit:

#+BEGIN_SRC sh :export ~/.gnupg/gpg-agent.conf
pinentry-program /usr/local/bin/pinentry-mac
#+END_SRC
** asdf
Install =asdf=:

#+BEGIN_SRC sh :export none :eval query
git clone https://github.com/asdf-vm/asdf ~/.asdf
cd ~/.asdf
git checkout "$(git describe --abbrev=0 --tags)"

echo -e "\nsource $HOME/.asdf/.asdf.sh" >> ~/.zshrc
#+END_SRC
** direnv
Install =direnv=:

#+BEGIN_SRC sh :export none :eval query
asdf plugin add direnv
asdf install direnv 2.21.3
#+END_SRC
** nodejs
Install NodeJS:

#+BEGIN_SRC sh :export none :eval query
asdf plugin add nodejs
bash -c '${ASDF_DATA_DIR:=$HOME/.asdf}/plugins/nodejs/bin/import-release-team-keyring'
asdf install nodejs 11.15.0
#+END_SRC
** postgres
Install =postgres=, mostly for the =psql= CLI tool:

#+BEGIN_SRC :export none :eval query
asdf plugin add postgres
asdf install postgres 10.13
#+END_SRC
** elixir
Install build tools, wxWidgets (observer support), and Java (jinterface):

#+BEGIN_SRC sh :export none :eval query
brew install autoconf wxmac
asdf plugin add java
asdf install java openjdk-14.0.1
#+END_SRC

Install Erlang with doc support:

#+BEGIN_SRC sh :export none :eval query
export KERL_BUILD_DOCS=yes
asdf plugin add erlang
asdf install erlang 23.0.2
#+END_SRC

Install Elixir:

#+BEGIN_SRC sh :export none :eval query
asdf plugin add elixir
asdf install elixir 1.10.3-otp-23
mix do local.hex --force, local.rebar --force
#+END_SRC
** lsp
Download and build ElixirLS:

#+BEGIN_SRC sh :export none :eval query
git clone https://github.com/elixir-lsp/elixir-ls ~/.elixirls
cd ~/.elixirls

asdf install $(rg -N erlang .tool-versions)
asdf install $(rg -N elixir .tool-versions)

mix do deps.get, compile, elixir_ls.release -o release
#+END_SRC
** emacs
Install Emacs from Homebrew:

#+BEGIN_SRC sh :export none :eval query
brew tap d12frosted/emacs-plus
brew install emacs-plus@27 --with-no-titlebar --with-modern-sexy-v2-icon
#+END_SRC
** doom
Download and install =doom=:

#+BEGIN_SRC :export none :eval query
git clone https://github.com/hlissner/doom-emacs ~/.emacs.d
~/.emacs.d/bin/doom install
#+END_SRC

Overwrite default configuration with mine:

#+BEGIN_SRC sh :export none :eval query
rm ~/.doom.d/{config,init,packages}.el
ln -s "${PWD}/config.el" ~/.doom.d/config.el
ln -s "${PWD}/init.el" ~/.doom.d/init.el
ln -s "${PWD}/packages.el" ~/.doom.d/packages.el
#+END_SRC

Sync =doom= packages and configuration is complete:

#+BEGIN_SRC sh :export none :eval query
~/.emacs.d/bin/doom sync
#+END_SRC
** versions
Set global defaults with =~/.tool-versions=:

#+BEGIN_SRC conf :tangle ~/.tool-versions
erlang 23.0.2
elixir 1.10.3-otp-23
java openjdk-14.0.1
nodejs 11.15.0
postgres 10.13
direnv 2.21.3
#+END_SRC
